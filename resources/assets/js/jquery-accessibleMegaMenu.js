(function(a,b,c){"use strict";function d(b,c){this.element=b,this.settings=a.extend({},g,c),this._defaults=g,this._name="accessibleMegaMenu",this.mouseTimeoutID=null,this.focusTimeoutID=null,this.mouseFocused=!1,this.justFocused=!1,this.init()}function e(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}function f(b,c){var d,f,g,h=b.nodeName.toLowerCase();return"area"===h?(d=b.parentNode,f=d.name,b.href&&f&&"map"===d.nodeName.toLowerCase())&&(g=a("img[usemap=#"+f+"]")[0],!!g&&e(g)):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&e(b)}var g={uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open",toggleButtonClass:"accessible-megamenu-toggle",openDelay:0,closeDelay:250,openOnMouseover:!1},h={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}},j=b.clearTimeout,k=b.setTimeout,l=b.opera&&"[object Opera]"===b.opera.toString();d.prototype=function(){var e,f,g,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A=0,B="",C="ontouchstart"in b||b.navigator.msMaxTouchPoints;return e=function(b){return a(b).closest(":data(plugin_accessibleMegaMenu)").data("plugin_accessibleMegaMenu")},f=function(b){b=a(b);var c=this.settings;b.attr("id")||b.attr("id",c.uuidPrefix+"-"+new Date().getTime()+"-"+ ++A)},g=function(b,d){var e,f=a(b.target),g=this,i=this.settings,l=this.menu,m=f.closest("."+i.topNavItemClass),n=f.hasClass(i.panelClass)?f:f.closest("."+i.panelClass);if(x.call(this,!0),!d){j(g.focusTimeoutID),m.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","true"),m.find("[aria-expanded]").attr("aria-expanded","true").addClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","false");var o=a("html")[0].scrollTop,p=a("."+i.panelClass+"."+i.openClass).parent().offset().top;o>p&&(a("html")[0].scrollTop=p),"mouseover"===b.type&&f.is(":tabbable")&&1===m.length&&0===n.length&&0<l.has(c.activeElement).length&&(f.focus(),g.justFocused=!1),x.call(g)}else if(m=l.find("."+i.topNavItemClass+" ."+i.openClass+":first").closest("."+i.topNavItemClass),!(m.is(b.relatedTarget)||0<m.has(b.relatedTarget).length)){if(("mouseout"===b.type||"focusout"===b.type)&&0<m.has(c.activeElement).length)return;m.find("[aria-expanded]").attr("aria-expanded","false").removeClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","true"),("keydown"===b.type&&b.keyCode===h.ESCAPE||"DOMAttrModified"===b.type)&&(e=m.find(":tabbable:first"),k(function(){l.find("[aria-expanded]."+g.settings.panelClass).off("DOMAttrModified.accessible-megamenu"),e.focus(),g.justFocused=!1},99))}else 0===m.length&&l.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","true")},m=function(b){var c=a(b.target).closest(":tabbable"),d=c.closest("."+this.settings.topNavItemClass),e=c.closest("."+this.settings.panelClass);1===d.length&&0===e.length&&1===d.find("."+this.settings.panelClass).length&&(c.hasClass(this.settings.openClass)?this.justFocused?(b.preventDefault(),b.stopPropagation(),this.justFocused=!1):(C||!C&&!this.settings.openOnMouseover)&&(b.preventDefault(),b.stopPropagation(),g.call(this,b,c.hasClass(this.settings.openClass))):(b.preventDefault(),b.stopPropagation(),g.call(this,b),this.justFocused=!1))},n=function(){this.justMoved=!0},o=function(b){0===a(b.target).closest(this.menu).length&&(b.preventDefault(),b.stopPropagation(),g.call(this,b,!0))},p=function(b){"aria-expanded"===b.originalEvent.attrName&&"false"===b.originalEvent.newValue&&a(b.target).hasClass(this.settings.openClass)&&(b.preventDefault(),b.stopPropagation(),g.call(this,b,!0))},q=function(b){j(this.focusTimeoutID);var c=a(b.target),d=c.closest("."+this.settings.panelClass);c.addClass(this.settings.focusClass),this.justFocused=!this.mouseFocused||!this.settings.openOnMouseover&&this.mouseFocused,this.mouseFocused=!1,this.justFocused&&this.panels.not(d).filter("."+this.settings.openClass).length&&g.call(this,b)},r=function(c){this.justFocused=!1;var d=this,e=a(c.target),f=e.closest("."+this.settings.topNavItemClass);e.removeClass(this.settings.focusClass),d.focusTimeoutID=b.cvox?k(function(){b.cvox.Api.getCurrentNode(function(a){f.has(a).length?j(d.focusTimeoutID):d.focusTimeoutID=k(function(a,b,c){g.call(a,b,c)},275,d,c,!0)})},25):k(function(){d.mouseFocused&&null===c.relatedTarget||g.call(d,c,!0)},300)},s=function(b){var c,f,n,p,q,r,s=this.constructor===d?this:e(this),t=s.settings,u=a(a(this).is("."+t.hoverClass+":tabbable")?this:b.target),v=s.menu,w=s.topnavitems,x=u.closest("."+t.topNavItemClass),y=v.find(":tabbable"),z=u.hasClass(t.panelClass)?u:u.closest("."+t.panelClass),A=z.find("."+t.panelGroupClass),C=u.closest("."+t.panelGroupClass),D=b.keyCode||b.which,E=!1,F=h.keyMap[b.keyCode]||"",G=1===x.length&&0===z.length;if(!u.is("input:focus, select:focus, textarea:focus, button:focus")){switch(u.is("."+t.hoverClass+":tabbable")&&a("html").off("keydown.accessible-megamenu"),D){case h.ESCAPE:this.mouseFocused=!1,g.call(s,b,!0);break;case h.DOWN:b.preventDefault(),this.mouseFocused=!1,G?(g.call(s,b),E=1===x.find("."+t.panelClass+" :tabbable:first").focus().length):E=1===y.filter(":gt("+y.index(u)+"):first").focus().length,!E&&l&&(b.ctrlKey||b.metaKey)&&(y=a(":tabbable"),n=y.index(u),E=1===a(":tabbable:gt("+a(":tabbable").index(u)+"):first").focus().length);break;case h.UP:b.preventDefault(),this.mouseFocused=!1,G&&u.hasClass(t.openClass)?(g.call(s,b,!0),c=w.filter(":lt("+w.index(x)+"):last"),c.children("."+t.panelClass).length&&(E=1===c.find("[aria-expanded]").attr("aria-expanded","true").addClass(t.openClass).filter("."+t.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):!G&&(E=1===y.filter(":lt("+y.index(u)+"):last").focus().length),!E&&l&&(b.ctrlKey||b.metaKey)&&(y=a(":tabbable"),n=y.index(u),E=1===a(":tabbable:lt("+a(":tabbable").index(u)+"):first").focus().length);break;case h.RIGHT:b.preventDefault(),this.mouseFocused=!1,G?E=1===w.filter(":gt("+w.index(x)+"):first").find(":tabbable:first").focus().length:(A.length&&C.length&&(E=1===A.filter(":gt("+A.index(C)+"):first").find(":tabbable:first").focus().length),!E&&(E=1===x.find(":tabbable:first").focus().length));break;case h.LEFT:b.preventDefault(),this.mouseFocused=!1,G?E=1===w.filter(":lt("+w.index(x)+"):last").find(":tabbable:first").focus().length:(A.length&&C.length&&(E=1===A.filter(":lt("+A.index(C)+"):last").find(":tabbable:first").focus().length),!E&&(E=1===x.find(":tabbable:first").focus().length));break;case h.TAB:this.mouseFocused=!1,n=y.index(u),b.shiftKey&&G&&u.hasClass(t.openClass)?(g.call(s,b,!0),c=w.filter(":lt("+w.index(x)+"):last"),c.children("."+t.panelClass).length&&(E=c.children().attr("aria-expanded","true").addClass(t.openClass).filter("."+t.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus())):b.shiftKey&&0<n?E=1===y.filter(":lt("+n+"):last").focus().length:!b.shiftKey&&n<y.length-1?E=1===y.filter(":gt("+n+"):first").focus().length:l&&(y=a(":tabbable"),n=y.index(u),E=b.shiftKey?1===a(":tabbable:lt("+a(":tabbable").index(u)+"):last").focus().length:1===a(":tabbable:gt("+a(":tabbable").index(u)+"):first").focus().length),E&&b.preventDefault();break;case h.SPACE:case h.ENTER:if(G)b.preventDefault(),m.call(s,b);else return!0;break;default:if(j(this.keydownTimeoutID),B+=F===B?"":F,0===B.length)return;for(this.keydownTimeoutID=k(function(){B=""},1000),y=G&&!u.hasClass(t.openClass)?y.filter(":not(."+t.panelClass+" :tabbable)"):x.find(":tabbable"),b.shiftKey&&(y=a(y.get().reverse())),n=0;n<y.length;n++)if(p=y.eq(n),p.is(u)){f=1===B.length?n+1:n;break}for(r=new RegExp("^"+B.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i"),n=f;n<y.length;n++)if(p=y.eq(n),q=a.trim(p.text()),r.test(q)){E=!0,p.focus();break}if(!E)for(n=0;n<f;n++)if(p=y.eq(n),q=a.trim(p.text()),r.test(q)){p.focus();break}}s.justFocused=!1}},t=function(b){(a(b.target).closest(this.settings.panelClass)||a(b.target).closest(":focusable").length)&&(this.mouseFocused=!0,a(b.target).closest(this.settings.menuClass)&&a("html").on("keydown.accessible-megamenu",a.proxy(s,b.target))),j(this.mouseTimeoutID),this.mouseTimeoutID=k(function(){j(this.focusTimeoutID)},1)},u=function(b){j(this.mouseTimeoutID);var c=this;c.settings.openOnMouseover&&(this.mouseTimeoutID=k(function(){a(b.target).addClass(c.settings.hoverClass),g.call(c,b),a(b.target).closest(c.settings.menuClass)&&a("html").on("keydown.accessible-megamenu",a.proxy(s,b.target))},this.settings.openDelay))},v=function(b){j(this.mouseTimeoutID);var c=this;c.settings.openOnMouseover&&(a(b.target).removeClass(c.settings.hoverClass),c.mouseTimeoutID=k(function(){g.call(c,b,!0)},this.settings.closeDelay),a(b.target).is(":tabbable")&&a("html").off("keydown.accessible-megamenu"))},w=function(){var a="true"===this.toggleButton.attr("aria-expanded");this.toggleButton.attr({"aria-expanded":!a,"aria-pressed":!a})},x=function(b){var c=this.menu;b?(a("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu"),c.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu")):(a("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",a.proxy(o,this)),c.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",a.proxy(p,this)))},y=function(){var b=this.menu,d=this.toggleButton;b.on("focusin.accessible-megamenu",":focusable, ."+this.settings.panelClass,a.proxy(q,this)).on("focusout.accessible-megamenu",":focusable, ."+this.settings.panelClass,a.proxy(r,this)).on("keydown.accessible-megamenu",a.proxy(s,this)).on("mouseover.accessible-megamenu",a.proxy(u,this)).on("mouseout.accessible-megamenu",a.proxy(v,this)).on("mousedown.accessible-megamenu",a.proxy(t,this)).on("click.accessible-megamenu",a.proxy(m,this)),d.on("click.accessible-megamenu",a.proxy(w,this)),C&&b.on("touchmove.accessible-megamenu",a.proxy(n,this)),a(c.activeElement).closest(b).length&&a(c.activeElement).trigger("focusin.accessible-megamenu")},z=function(){var a=this.menu,b=this.toggleButton;a.off(".accessible-megamenu"),a.find("[aria-expanded=true]."+this.settings.panelClass).length&&x.call(this,!0),b.off(".accessible-megamenu")},{constructor:d,init:function(){var b=this.settings,c=a(this.element),d=c.children("ol,ul").first(),e=d.children(),f=c.children("button").first();this.start(b,c,d,e,f)},start:function(b,c,d,e,g){var h=this;this.settings=b,this.menu=d,this.topnavitems=e,this.toggleButton=g,c.attr("role","navigation"),f.call(h,d),d.addClass(b.menuClass),d.addClass(["js",b.menuClass].join("-")),e.each(function(c,d){var e,g;d=a(d),d.addClass(b.topNavItemClass),e=d.find(":tabbable:first"),g=d.children(":not(:tabbable):last"),f.call(h,e),g.length&&(f.call(h,g),e.attr({role:"button","aria-controls":g.attr("id"),"aria-expanded":!1,tabindex:0}),g.attr({role:"region","aria-expanded":!1,"aria-hidden":!0}).addClass(b.panelClass).not("[aria-labelledby]").attr("aria-labelledby",e.attr("id")))}),this.panels=d.find("."+b.panelClass),d.find("hr").attr("role","separator"),g.addClass(b.toggleButtonClass),g.attr({"aria-expanded":!1,"aria-pressed":!1,"aria-controls":d.attr("id")}),y.call(this)},destroy:function(){this.menu.removeClass(["js",this.settings.menuClass].join("-")),z.call(this,!0)},getDefaults:function(){return this._defaults},getOption:function(a){return this.settings[a]},getAllOptions:function(){return this.settings},setOption:function(a,b,c){this.settings[a]=b,c&&this.init()}}}(),a.fn.accessibleMegaMenu=function(b){return this.each(function(){var c=a.data(this,"plugin_accessibleMegaMenu");c?"function"==typeof c[b]&&c[b].apply(c,Array.prototype.slice.call(arguments,1)):a.data(this,"plugin_accessibleMegaMenu",new a.fn.accessibleMegaMenu.AccessibleMegaMenu(this,b))})},a.fn.accessibleMegaMenu.AccessibleMegaMenu=d,a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return f(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var c=a.attr(b,"tabindex"),d=isNaN(c);return(d||0<=c)&&f(b,!d)}})})(jQuery,window,document);